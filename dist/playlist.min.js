/*! playlist.js v0.0.2 - MIT license 
2014-11-28 - Florent Solt */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){window.Playlist=a("./core"),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,window.$(function(){Playlist.ui.discover()})},{"./core":2}],2:[function(a,b){"use strict";var c=b.exports.ui=a("./ui"),d=a("./oscillo"),e=function(){},f={index:0,audio:null,volume:100,fade:5,currentBuffer:null,nextBuffer:null,songs:[],allSongs:[],loop:!0,oscillo:!1,interval:null,source:null,analyser:null,data:null,events:{play:e,pause:e,stop:e,mute:e,unmute:e,next:e,prev:e,time:e,restart:e}},g=new window.AudioContext;b.exports.on=function(a,b){"function"==typeof b?f.events[a]?f.events[a]=b:console.log("Unknown event: "+a):console.log("Playlist.on needs a funciton as 2nd argument.")},b.exports.setSongs=function(a){Array.isArray(a)?a.forEach(function(a){"string"==typeof a.src&&"string"==typeof a.title&&"string"==typeof a.artwork?f.allSongs.push(a):console.log("Invalid song (src, title or artwork property missing or invalid).",a),f.songs=f.allSongs}):console.log("Playlist.setSongs only accet array of songs.")},b.exports.getSongs=function(){return f.songs},b.exports.filterSongs=function(a){f.songs=a===!1||"function"!=typeof a?f.allSongs:f.allSongs.filter(a)},b.exports.setOscillo=function(a){f.oscillo=!!a,f.oscillo===!0?(h(),d.show()):d.hide()},b.exports.getOscillo=function(){return f.oscillo},b.exports.setVolume=function(a){a=a||f.volume,"number"==typeof a?a>=0&&100>=a?(f.volume=a,f.audio&&(f.audio.volume=a/100)):console.log("Volume should be between 0 and 100."):console.log("Invalid index.")},b.exports.isPlaying=function(){return f.audio?!f.audio.paused:!1},b.exports.play=function(){f.audio?(f.audio.play(),c.update(f.songs[f.index]),f.events.play(f.songs[f.index]),f.oscillo&&h()):(f.index=-1,b.exports.next())},b.exports.restart=function(){f.audio.pause(),f.audio.currentTime=0,i(0),f.events.restart(),b.exports.play()},b.exports.stop=function(){f.audio.pause(),f.audio.currentTime=0,f.events.stop()},b.exports.pause=function(){f.audio.pause(),c.update(f.songs[f.index]),f.events.pause()},b.exports.next=function(){f.autio&&f.audio.pause(),f.loop?i((f.index+1)%f.songs.length):f.index+1<f.songs.length&&i(f.index+1),b.exports.play(),f.events.next()},b.exports.prev=function(){f.loop?i((f.songs.length+f.index-1)%f.songs.length):f.index-1>=0&&i(f.index-1),b.exports.play(),f.events.prev()},b.exports.shuffle=function(){for(var a,b,c=f.songs.length;c;a=Math.floor(Math.random()*c),b=f.songs[--c],f.songs[c]=f.songs[a],f.songs[a]=b);},b.exports.setLoop=function(a){f.loop=!!a};var h=function(){f.oscillo&&b.exports.isPlaying()&&(null===f.analyser&&(f.source=g.createMediaElementSource(f.audio),f.analyser=g.createAnalyser(),f.data=new Uint8Array(f.analyser.frequencyBinCount),f.source.connect(f.analyser),f.source.connect(g.destination)),f.analyser.getByteTimeDomainData(f.data),d.draw(f.data),requestAnimationFrame(h))},i=function(a){f.index=a,f.audio&&(f.audio.removeEventListener("timeupdate",j.time),f.audio.removeEventListener("ended",j.end),f.audio.pause()),f.audio=new Audio,f.audio.src=f.songs[f.index].src,f.audio.addEventListener("timeupdate",j.time),f.audio.addEventListener("ended",j.end),b.exports.setVolume(),f.analyser=null,h()},j={time:function(){var a=f.audio.currentTime||0,b=f.audio.duration||0,d={current:{seconds:(Math.floor(a%60)<10?"0":"")+Math.floor(a%60),minutes:Math.floor(a/60)},duration:{seconds:(Math.floor(b%60)<10?"0":"")+Math.floor(b%60),minutes:Math.floor(b/60)}};return d.current.text=d.current.minutes+":"+d.current.seconds,d.duration.text=d.duration.minutes+":"+d.duration.seconds,c.time(d),f.events.time(d),d},end:function(){f.loop&&b.exports.next()},fade:function(){var a=(j.time(),Math.min(f.fade,this.duration-f.fade));this.currentTime<a&&(this.volume=(1-(a-this.currentTime)/a)*f.volume/100),this.currentTime+f.fade>this.duration&&(this==f.audio&&b.exports.next(),this.volume=(this.duration-this.currentTime)/f.fade*f.volume/100)}}},{"./oscillo":3,"./ui":4}],3:[function(a,b){var c={canvas:null,ctx2d:null,widht:null,height:null,quarterHeight:null,scaling:null,sampling:1,min:134};b.exports.init=function(a){c.canvas=a,c.ctx2d=a.get(0).getContext("2d"),c.width=a.attr("width"),c.height=a.attr("height"),c.quarterHeight=c.height/4,c.scaling=c.height/256},b.exports.hide=function(){c.canvas.css("display","none")},b.exports.show=function(){c.canvas.css("display","block")},b.exports.draw=function(a){c.ctx2d.lineWidth=3,c.ctx2d.strokeStyle="white",c.ctx2d.beginPath(),c.ctx2d.clearRect(0,0,c.width,c.height);var b=d(a,c.width);c.ctx2d.moveTo(0,(256-a[b])*c.scaling);for(var e=b,f=0;f<c.width&&e<a.length;e+=c.sampling,f++)c.ctx2d.lineTo(f*c.sampling,(256-a[e])*c.scaling);c.ctx2d.stroke()};var d=function(a,b){for(var d,e=0,f=-1;b>e&&a[e]>128;)e++;if(e>=b)return 0;for(;b>e&&(d=a[e])<c.min;)d>=128?-1==f&&(f=e):f=-1,e++;return-1==f&&(f=e),e==b?0:0===f?0:f}},{}],4:[function(a,b){"use strict";var c=a("./core"),d=a("./oscillo"),e={title:null,artwork:null,play:null,next:null,prev:null,stop:null,volume:null,mute:null,time:null};b.exports.discover=function(a){a=a||"#player",window.$.each(e,function(b){e[b]=window.$(a+" ."+b)}),e.artwork.css({position:"relative","background-size":"cover","background-position":"50% 50%"}),e.play.click(function(){c.isPlaying()?c.pause():c.play()}),e.next.click(c.next),e.prev.click(c.prev),e.oscillo=window.$("<canvas>").css({position:"absolute",display:"none",top:"0px",left:"0px",width:e.artwork.width()+"px",height:e.artwork.height()+"px"}).attr("width",e.artwork.width()).attr("height",e.artwork.height()),e.artwork.prepend(e.oscillo),d.init(e.oscillo)},b.exports.update=function(a){e.title.text(a.title),e.artwork.css("background-image","url("+a.artwork+")"),c.isPlaying()?e.play.removeClass("fa-play").addClass("fa-pause"):e.play.removeClass("fa-pause").addClass("fa-play")},b.exports.time=function(a){e.time.find(".current").text(a.current.text),e.time.find(".duration").text(a.duration.text)}},{"./core":2,"./oscillo":3}]},{},[1,2,3,4]);